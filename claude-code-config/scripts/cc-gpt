#!/bin/bash

# Check if port 4000 is open (LiteLLM running)
if ! lsof -i:4000 >/dev/null 2>&1; then
    echo "Port 4000 not open, starting LiteLLM..."

    # Open a new terminal and start LiteLLM in background
    osascript -e 'tell application "Terminal" to do script "cd ~/.claude/claude-code-gpt-5 && uv run litellm --config config.yaml"' >/dev/null 2>&1

    # Wait a bit for LiteLLM to start
    echo "Waiting for LiteLLM to start..."
    for i in {1..10}; do
        if lsof -i:4000 >/dev/null 2>&1; then
            echo "LiteLLM started successfully!"
            break
        fi
        sleep 1
    done

    if ! lsof -i:4000 >/dev/null 2>&1; then
        echo "Warning: LiteLLM may not have started properly"
    fi
fi

# Launch Claude with custom base URL
ANTHROPIC_BASE_URL=http://localhost:4000 claude --dangerously-skip-permissions "$@"