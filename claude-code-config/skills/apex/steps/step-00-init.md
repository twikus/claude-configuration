---
name: step-00-init
description: Initialize APEX workflow - parse flags, detect continuation, setup state
next_step: steps/step-01-analyze.md
---

# Step 0: Initialization

## MANDATORY EXECUTION RULES (READ FIRST):

- ğŸ›‘ NEVER skip flag parsing
- ğŸ›‘ ONLY check for existing workflow if resume_task is set
- âœ… ALWAYS parse ALL flags before any other action
- âœ… ONLY check for resume if {resume_task} is set
- ğŸ“‹ YOU ARE AN INITIALIZER, not an executor
- ğŸ’¬ FOCUS on setup only - don't look ahead to implementation
- ğŸš« FORBIDDEN to load step-01 until init is complete

## EXECUTION PROTOCOLS:

- ğŸ¯ Parse flags first, then check resume, then setup
- ğŸ’¾ Create output structure if save_mode enabled
- ğŸ“– Initialize all state variables before proceeding
- ğŸš« FORBIDDEN to start analysis (that's step-01's job)
- âœ… ALWAYS show COMPACT summary (one table) and proceed immediately
- ğŸš« FORBIDDEN to show verbose parsing logs or explanations

## CONTEXT BOUNDARIES:

- This is the FIRST step - no previous context exists
- User input contains flags and task description
- Output folder may or may not exist
- Don't assume anything about the codebase yet

## YOUR TASK:

Initialize the APEX workflow by parsing flags, detecting continuation state, and setting up the execution environment.

---

<defaults>
## Default Configuration

**Edit these values to change default behavior. Flags always override defaults.**

```yaml
# ===========================================
# APEX DEFAULT SETTINGS
# ===========================================

auto_mode: false # -a: Skip confirmations, use recommended options
examine_mode: false # -x: Auto-proceed to adversarial review
save_mode: false # -s: Save outputs to .claude/output/apex/
test_mode: false # -t: Include test creation and runner steps
economy_mode: false # -e: No subagents, save tokens (for limited plans)
branch_mode: false # -b: Verify not on main, create branch if needed
pr_mode: false # -pr: Create pull request at end (enables -b)
interactive_mode: false # -i: Configure flags interactively

# Presets:
# Budget-friendly:  economy_mode: true
# Full quality:     examine_mode: true, save_mode: true, test_mode: true
# Autonomous:       auto_mode: true, examine_mode: true, save_mode: true, test_mode: true
```

**Flag Reference:** See `SKILL.md` for complete flag documentation and examples.

</defaults>

---

## EXECUTION SEQUENCE:

### 1. Parse Flags and Input

**Step 1: Load defaults from config above**

```
{auto_mode}    = <default>
{examine_mode} = <default>
{save_mode}    = <default>
{test_mode}    = <default>
{economy_mode} = <default>
{branch_mode}  = <default>
{pr_mode}      = <default>
{interactive_mode} = <default>
```

**Step 2: Parse user input and override defaults:**

```
Enable flags (lowercase - turn ON):
  -a or --auto     â†’ {auto_mode} = true
  -x or --examine  â†’ {examine_mode} = true
  -s or --save     â†’ {save_mode} = true
  -t or --test     â†’ {test_mode} = true
  -e or --economy  â†’ {economy_mode} = true

Disable flags (UPPERCASE - turn OFF):
  -A or --no-auto         â†’ {auto_mode} = false
  -X or --no-examine      â†’ {examine_mode} = false
  -S or --no-save         â†’ {save_mode} = false
  -T or --no-test         â†’ {test_mode} = false
  -E or --no-economy      â†’ {economy_mode} = false
  -B or --no-branch       â†’ {branch_mode} = false
  -PR or --no-pull-request â†’ {pr_mode} = false

Branch/PR flags:
  -b or --branch        â†’ {branch_mode} = true
  -pr or --pull-request â†’ {pr_mode} = true, {branch_mode} = true

Interactive:
  -i or --interactive   â†’ {interactive_mode} = true

Other:
  -r or --resume   â†’ {resume_task} = <next argument>
  Remainder        â†’ {task_description}
```

**Step 3: Generate feature_name and task_id:**

```
{feature_name} = kebab-case-description (without number prefix)

Example: "add user authentication" â†’ "add-user-authentication"

{task_id} will be generated by the setup script:
  - Script auto-detects next available number in .claude/output/apex/
  - Result: "01-add-user-authentication" (or 02, 03, etc.)
```

### 2. Check Resume Mode

<critical>
ONLY execute this section if {resume_task} is set!
If {resume_task} is NOT set, skip directly to step 3.
</critical>

**If `{resume_task}` is set:**

1. **Search for matching task:**

   ```bash
   ls .claude/output/apex/ | grep "^{resume_task}"
   ```

2. **If exact match found:**
   - Read `00-context.md` to restore state variables
   - Scan step files to find last completed step (check for completion marker)
   - Load next incomplete step
   - **STOP** - do not continue with fresh init

3. **If partial match (e.g., `-r 01`):**
   - If single match: use it
   - If multiple matches: list them and ask user to specify

4. **If no match found:**
   - List available tasks
   - Ask user to provide correct ID

**If {resume_task} is NOT set:** â†’ Skip directly to step 3

### 3. Run Optional Sub-Steps

**Load sub-steps in order (if flags enabled):**

```
IF {interactive_mode} = true:
  â†’ Load steps/step-00b-interactive.md
  â†’ User configures flags interactively
  â†’ Return here with updated flags

IF {branch_mode} = true:
  â†’ Load steps/step-00b-branch.md
  â†’ Verify/create branch
  â†’ Return here with {branch_name} set

IF {economy_mode} = true:
  â†’ Load steps/step-00b-economy.md
  â†’ Apply economy overrides
```

### 4. Create Output Structure (if save_mode)

**If `{save_mode}` = true:**

Run the template setup script to initialize all output files:

```bash
bash {skill_dir}/scripts/setup-templates.sh \
  "{feature_name}" \
  "{task_description}" \
  "{auto_mode}" \
  "{examine_mode}" \
  "{save_mode}" \
  "{test_mode}" \
  "{economy_mode}" \
  "{branch_mode}" \
  "{pr_mode}" \
  "{interactive_mode}" \
  "{branch_name}" \
  "{original_input}"
```

**Note:** Pass `{feature_name}` (without number prefix), NOT `{task_id}`.
The script auto-detects the next available number from existing folders.

This script:

- Auto-generates `{task_id}` = `NN-{feature_name}` (next available number)
- Creates `.claude/output/apex/{task_id}/` directory
- Initializes `00-context.md` with configuration and progress table
- Pre-creates all step files from templates (01-analyze.md, 02-plan.md, etc.)
- Only creates files for enabled steps (examine, tests, PR)
- Outputs the generated `{task_id}` for use in subsequent steps

### 5. Initialize and Proceed

**Always (regardless of auto_mode):**

Show COMPACT initialization summary (one table, then proceed immediately):

```
âœ“ APEX: {task_description}

| Variable | Value |
|----------|-------|
| `{task_id}` | 01-kebab-name |
| `{auto_mode}` | true/false |
| `{examine_mode}` | true/false |
| `{save_mode}` | true/false |
| `{test_mode}` | true/false |
| `{economy_mode}` | true/false |
| `{branch_mode}` | true/false |
| `{pr_mode}` | true/false |

â†’ Analyzing...
```

<critical>
KEEP OUTPUT MINIMAL:
- One line header with task
- One table with ALL variables (use brackets to show they're available)
- One line "â†’ Analyzing..." then IMMEDIATELY load step-01
- NO verbose explanations, NO parsing logs, NO separators
</critical>

**Then proceed directly to step-01-analyze.md**

---

## SUCCESS METRICS:

âœ… All flags correctly parsed (enable AND disable)
âœ… Output is COMPACT (one table, no verbose logs)
âœ… Variables shown with `{brackets}` notation
âœ… Proceeded to step-01 immediately after table
âœ… Output folder created with 00-context.md (if save_mode)

## FAILURE MODES:

âŒ Verbose output with separators and explanations
âŒ Showing parsing steps/logs to user
âŒ Not using `{variable}` bracket notation
âŒ Not proceeding immediately after summary
âŒ **CRITICAL**: Blocking workflow with unnecessary confirmations

## INITIALIZATION PROTOCOLS:

- Parse ALL flags before any other action
- Check resume BEFORE creating new output folder
- Verify branch BEFORE creating output structure (if branch_mode)
- Create output structure BEFORE confirming start
- Load economy overrides BEFORE proceeding to step-01

---

## NEXT STEP:

After showing initialization summary, always proceed directly to `./step-01-analyze.md`

<critical>
Remember:
- Step-00 is an INITIALIZER, not a GATEKEEPER
- Output MUST be compact: one table, no verbose logs
- Use `{variable}` notation to show available state
- Proceed immediately - never block!
</critical>
