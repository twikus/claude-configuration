---
name: step-09-finish
description: Finish APEX workflow and create pull request
previous_step: step-08-run-tests.md (or step-04-validate.md if no tests)
---

# Step 9: Finish & Create PR

## MANDATORY EXECUTION RULES (READ FIRST):

- ðŸ›‘ NEVER push without user confirmation (unless auto_mode)
- ðŸ›‘ NEVER create PR if there are uncommitted changes
- âœ… ALWAYS verify all changes are committed
- âœ… ALWAYS push to remote before creating PR
- ðŸ“‹ YOU ARE A FINISHER, completing the workflow
- ðŸ’¬ FOCUS on PR creation and workflow summary
- ðŸš« FORBIDDEN to make code changes in this step

## EXECUTION PROTOCOLS:

- ðŸŽ¯ Verify git status before any push/PR operations
- ðŸ’¾ Save PR details to output file if save_mode enabled
- ðŸ“– Provide clear workflow summary
- ðŸš« FORBIDDEN to proceed with uncommitted changes

## CONTEXT BOUNDARIES:

- Variables available: `{task_id}`, `{task_description}`, `{branch_name}`, `{pr_mode}`, `{auto_mode}`, `{save_mode}`, `{output_dir}`
- Previous steps completed: analyze, plan, execute, validate (+ optional: tests, examine)
- All implementation should be done at this point

## YOUR TASK:

Finalize the APEX workflow by committing remaining changes, pushing to remote, and creating a pull request.

---

## EXECUTION SEQUENCE:

### 1. Verify Git Status

```bash
git status
```

**If uncommitted changes exist:**
â†’ Commit them with message: `feat({task_id}): {task_description}`

**If working tree is clean:**
â†’ Continue to step 2

### 2. Check Commits to Push

```bash
git log origin/{branch_name}..HEAD --oneline 2>/dev/null || git log --oneline -5
```

Display commits that will be included in PR.

### 3. Confirm Push (if not auto_mode)

**If `{auto_mode}` = true:**
â†’ Auto-push to remote

**If `{auto_mode}` = false:**
Use AskUserQuestion:
```yaml
questions:
  - header: "Push"
    question: "Ready to push {branch_name} and create PR?"
    options:
      - label: "Push and create PR (Recommended)"
        description: "Push commits to remote and open pull request"
      - label: "Push only"
        description: "Push to remote without creating PR"
      - label: "Review commits first"
        description: "Show me the full diff before pushing"
      - label: "Cancel"
        description: "Don't push or create PR"
    multiSelect: false
```

### 4. Push to Remote

```bash
git push -u origin {branch_name}
```

**If push fails:**
â†’ Display error and ask user how to proceed
â†’ Common fixes: pull --rebase, force push (with warning)

### 5. Create Pull Request (if pr_mode)

**If `{pr_mode}` = true:**

Generate PR content:
- **Title:** `feat({task_id}): {task_description}`
- **Body:** Summary of changes from the workflow

```bash
gh pr create --title "feat({task_id}): {task_description}" --body "$(cat <<'EOF'
## Summary

{Brief description of what was implemented}

## Changes

{List of key changes made}

## Testing

{How the changes were validated}

---

_Generated by APEX workflow_
EOF
)"
```

**Capture PR URL:**
```bash
gh pr view --json url -q '.url'
```
â†’ Store as `{pr_url}`

### 6. Save Output (if save_mode)

**If `{save_mode}` = true:**

```bash
bash {skill_dir}/scripts/update-progress.sh "{task_id}" "09" "finish" "in_progress"
```

Append to `{output_dir}/09-finish.md`: branch, PR URL, commits, timestamp.

```bash
bash {skill_dir}/scripts/update-progress.sh "{task_id}" "09" "finish" "complete"
```

### 7. Final Summary

Display workflow completion summary:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  APEX WORKFLOW COMPLETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Task: {task_description}
  ID: {task_id}

  âœ“ Analysis complete
  âœ“ Plan created and approved
  âœ“ Implementation done
  âœ“ Validation passed
  {if test_mode: "âœ“ Tests passing"}
  {if examine_mode: "âœ“ Review findings resolved"}
  âœ“ Changes pushed to {branch_name}
  {if pr_mode: "âœ“ PR created: {pr_url}"}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SUCCESS METRICS:

âœ… All changes committed
âœ… Branch pushed to remote
âœ… PR created with proper title and description (if pr_mode)
âœ… PR URL captured and displayed
âœ… Output saved (if save_mode)
âœ… Clear completion summary provided

## FAILURE MODES:

âŒ Creating PR with uncommitted changes
âŒ Pushing without user confirmation (when not auto_mode)
âŒ Force pushing without explicit user request
âŒ Not displaying PR URL after creation
âŒ **CRITICAL**: Using plain text prompts instead of AskUserQuestion

---

## WORKFLOW COMPLETE

This is the final step of the APEX workflow. No next step to load.

<critical>
Remember: This step ONLY handles git operations and PR creation. All code changes should have been completed in earlier steps.
</critical>
